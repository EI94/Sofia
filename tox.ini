[tox]
envlist = py311, e2e, bulk, lint

[testenv]
deps =
    pytest==7.4.0
    pytest-asyncio==0.21.1
    pytest-mock==3.11.1
    requests>=2.28.0
    psutil>=5.9.0
    google-cloud-firestore==2.18.0
    fastapi==0.111.0
    uvicorn==0.30.0
    openai==1.57.0
    twilio==9.0.0
    python-multipart>=0.0.20
    fasttext>=0.9.2
    aiohttp>=3.10.11
    PyYAML>=6.0.1
commands =
    pytest {posargs:sofia_lite/tests/}

[testenv:bulk]
deps =
    {[testenv]deps}
    httpx==0.27.0
    slowapi==0.1.9
    tinydb==4.8.0
    boto3==1.34.0
    pydantic==2.10.0
    python-dotenv==1.0.0
commands =
    pip install -e .
    pytest {posargs:tests_bulk/} -m bulk

[testenv:e2e]
deps =
    {[testenv]deps}
setenv =
    GOOGLE_CLOUD_PROJECT = test-project
    GOOGLE_APPLICATION_CREDENTIALS = /dev/null
    OPENAI_API_KEY = test-key
    ELEVENLABS_API_KEY = test-key
    TWILIO_ACCOUNT_SID = test-sid
    TWILIO_AUTH_TOKEN = test-token
commands =
    # Run simplified E2E tests
    python -c "import sofia_lite; print('✅ Core imports OK')"
    python -c "import sofia_bulk_api; print('✅ Bulk API imports OK')"
    python -c "from sofia_lite.agents.state import State; print('✅ State imports OK')"
    python -c "from sofia_bulk_api.schemas import ConversationIn; print('✅ Bulk schemas OK')"

[testenv:lint]
deps =
    black>=22.0.0
    isort>=5.10.0
    flake8>=4.0.0
commands =
    black --check sofia_lite/ sofia_bulk_api/
    isort --check-only sofia_lite/ sofia_bulk_api/
    flake8 sofia_lite/ sofia_bulk_api/

[testenv:format]
deps =
    black>=22.0.0
    isort>=5.10.0
commands =
    black sofia_lite/ sofia_bulk_api/
    isort sofia_lite/ sofia_bulk_api/

[flake8]
max-line-length = 88
extend-ignore = E203, W503
exclude = .git,__pycache__,build,dist,*.egg-info

[isort]
profile = black
multi_line_output = 3
line_length = 88 