2025-07-26 22:52:55,062 | INFO | __main__ | 🚀 AVVIO TEST FINALE SOFIA AI RAG/MEMORY
2025-07-26 22:52:55,062 | INFO | __main__ | 🧪 TEST CONVERSAZIONE COMPLETA
2025-07-26 22:52:55,076 | INFO | app.chains.planner | 🔧 Inizializzazione gateways...
2025-07-26 22:52:55,076 | WARNING | app.gateways.memory | ⚠️ Firestore client non disponibile - uso memoria locale
2025-07-26 22:52:55,076 | INFO | app.chains.planner | ✅ Memory gateway inizializzato
2025-07-26 22:52:55,076 | INFO | app.chains.planner | ✅ Calendar gateway inizializzato
2025-07-26 22:52:55,331 | INFO | app.gateways.llm | 🔍 API Key trovata: NO
2025-07-26 22:52:55,331 | ERROR | app.gateways.llm | ❌ OPENAI_API_KEY non configurata
2025-07-26 22:52:55,331 | INFO | app.chains.planner | ✅ LLM gateway inizializzato
2025-07-26 22:52:55,331 | INFO | app.chains.planner | 🔧 Inizializzazione Sofia Planner...
2025-07-26 22:52:55,331 | INFO | app.chains.planner | ✅ Sofia Planner inizializzato
2025-07-26 22:52:55,331 | INFO | __main__ | 🧪 Test 1: Primo messaggio 'Ciao'
2025-07-26 22:52:55,331 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234567, Message: Ciao...
2025-07-26 22:52:55,331 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,331 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234567', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,331 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,331 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Ciao...
2025-07-26 22:52:55,331 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,331 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,332 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,332 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,332 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Ciao...
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: GREETING (primo turno)
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: GREETING (confidence: 0.8)
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: GREETING
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: present_sofia
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: present_sofia, Instruction: Presentati come Sofia e chiedi come puoi aiutare
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6371 caratteri
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,332 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,332 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'GREETING', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,332 | INFO | __main__ | ✅ Test 1 OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,332 | INFO | __main__ | 🧪 Test 2: Richiesta servizi
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234567, Message: Che servizi offrite?...
2025-07-26 22:52:55,332 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234567', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Che servizi offrite?...
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,332 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,332 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,332 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,332 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Che servizi offrite?...
2025-07-26 22:52:55,332 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: ASK_SERVICE (servizi richiesti)
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: ASK_SERVICE (confidence: 0.8)
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: ASK_SERVICE
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'explain_service', 'instruction': 'Spiega il servizio richiesto e il costo 60€'}
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'explain_service', 'instruction': 'Spiega il servizio richiesto e il costo 60€'}
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: explain_service
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: explain_service, Instruction: Spiega il servizio richiesto e il costo 60€
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6384 caratteri
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,332 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,332 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'ASK_SERVICE', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,332 | INFO | __main__ | ✅ Test 2 OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,332 | INFO | __main__ | 🧪 Test 3: Fornire nome 'Mi chiamo Pierpaolo'
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234567, Message: Mi chiamo Pierpaolo...
2025-07-26 22:52:55,332 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,332 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234567', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Mi chiamo Pierpaolo...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,333 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,333 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,333 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,333 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Mi chiamo Pierpaolo...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: GREETING (primo turno)
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: GREETING (confidence: 0.8)
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: GREETING
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: present_sofia
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: present_sofia, Instruction: Presentati come Sofia e chiedi come puoi aiutare
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6386 caratteri
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,333 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,333 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'GREETING', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,333 | INFO | __main__ | ✅ Test 3 OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,333 | INFO | __main__ | 🧪 Test 4: Richiesta consulenza
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234567, Message: Vorrei una consulenza per permesso di soggiorno...
2025-07-26 22:52:55,333 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234567', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Vorrei una consulenza per permesso di soggiorno...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,333 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,333 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,333 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,333 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Vorrei una consulenza per perm...
2025-07-26 22:52:55,333 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: PROPOSE_CONSULT (consulenza richiesta)
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: PROPOSE_CONSULT (confidence: 0.8)
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: PROPOSE_CONSULT
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'propose_consultation', 'instruction': 'Chiedi se preferisce online o in presenza'}
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'propose_consultation', 'instruction': 'Chiedi se preferisce online o in presenza'}
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: propose_consultation
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: propose_consultation, Instruction: Chiedi se preferisce online o in presenza
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6414 caratteri
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,333 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,333 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,333 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'PROPOSE_CONSULT', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,333 | INFO | __main__ | ✅ Test 4 OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,333 | INFO | __main__ | 🧪 Test 5: Messaggio vuoto
2025-07-26 22:52:55,333 | WARNING | app.core.planner.manager_worker_planner | ⚠️ Messaggio vuoto ricevuto
2025-07-26 22:52:55,334 | INFO | __main__ | ✅ Test 5 OK: Non ho ricevuto il tuo messaggio. Puoi ripetere?...
2025-07-26 22:52:55,334 | INFO | __main__ | 🧪 Test 6: Messaggio None
2025-07-26 22:52:55,334 | ERROR | app.core.planner.manager_worker_planner | ❌ ERRORE CRITICO: user_message è None!
2025-07-26 22:52:55,334 | INFO | __main__ | ✅ Test 6 OK: Mi dispiace, c'è stato un problema tecnico. Riprov...
2025-07-26 22:52:55,334 | INFO | __main__ | ✅ TUTTI I TEST CONVERSAZIONE SUPERATI!
2025-07-26 22:52:55,334 | INFO | __main__ | 🧪 TEST PERSISTENZA MEMORIA
2025-07-26 22:52:55,334 | WARNING | app.gateways.memory | ⚠️ Firestore client non disponibile - uso memoria locale
2025-07-26 22:52:55,334 | INFO | __main__ | 🧪 Test memoria 1: Primo messaggio
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234568, Message: Ciao, mi chiamo Maria...
2025-07-26 22:52:55,334 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234568', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Ciao, mi chiamo Maria...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,334 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,334 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,334 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,334 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Ciao, mi chiamo Maria...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: GREETING (primo turno)
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: GREETING (confidence: 0.8)
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: GREETING
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: present_sofia
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: present_sofia, Instruction: Presentati come Sofia e chiedi come puoi aiutare
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6388 caratteri
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,334 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,334 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'GREETING', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,334 | INFO | __main__ | 🧪 Test memoria 2: Verifica memoria
2025-07-26 22:52:55,334 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,334 | INFO | __main__ | ✅ Dati utente: None
2025-07-26 22:52:55,334 | INFO | __main__ | 🧪 Test memoria 3: Secondo messaggio
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234568, Message: Vorrei informazioni sui servizi...
2025-07-26 22:52:55,334 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234568', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Vorrei informazioni sui servizi...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,334 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,334 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,334 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,334 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Vorrei informazioni sui serviz...
2025-07-26 22:52:55,334 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: ASK_SERVICE (servizi richiesti)
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: ASK_SERVICE (confidence: 0.8)
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: ASK_SERVICE
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'explain_service', 'instruction': 'Spiega il servizio richiesto e il costo 60€'}
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'explain_service', 'instruction': 'Spiega il servizio richiesto e il costo 60€'}
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: explain_service
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: explain_service, Instruction: Spiega il servizio richiesto e il costo 60€
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6395 caratteri
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,334 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,334 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,334 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'ASK_SERVICE', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,335 | INFO | __main__ | ✅ Test memoria OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,335 | INFO | __main__ | ✅ TEST PERSISTENZA MEMORIA SUPERATO!
2025-07-26 22:52:55,335 | INFO | __main__ | 🧪 TEST CASI LIMITE
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234569, Message: Ciao, vorrei una consulenza per il mio permesso di...
2025-07-26 22:52:55,335 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234569', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Ciao, vorrei una consulenza per il mio permesso di...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,335 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,335 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,335 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,335 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Ciao, vorrei una consulenza pe...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: GREETING (primo turno)
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: GREETING (confidence: 0.8)
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: GREETING
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: present_sofia
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: present_sofia, Instruction: Presentati come Sofia e chiedi come puoi aiutare
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6613 caratteri
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,335 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,335 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'GREETING', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,335 | INFO | __main__ | ✅ Test messaggio lungo OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234569, Message: Ciao! Vorrei una consulenza per il mio permesso di...
2025-07-26 22:52:55,335 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234569', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Ciao! Vorrei una consulenza per il mio permesso di...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,335 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,335 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,335 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,335 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Ciao! Vorrei una consulenza pe...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: GREETING (primo turno)
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: GREETING (confidence: 0.8)
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: GREETING
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: present_sofia
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: present_sofia, Instruction: Presentati come Sofia e chiedi come puoi aiutare
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6438 caratteri
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,335 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,335 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'GREETING', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,335 | INFO | __main__ | ✅ Test caratteri speciali OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 PLAN INIZIATO - Phone: 393271234569, Message: Hello, I need help with my residence permit...
2025-07-26 22:52:55,335 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, restituisco None
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Contesto utente caricato: {'phone': '393271234569', 'name': None, 'lang': 'it', 'summary': '', 'turn_count': 0}
2025-07-26 22:52:55,335 | INFO | app.core.planner.manager_worker_planner | 🔍 Classificazione stato in corso...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 CLASSIFY STATE - Message: Hello, I need help with my residence permit...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 Invio prompt classificazione a LLM...
2025-07-26 22:52:55,335 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 LLM response classificazione: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratich...
2025-07-26 22:52:55,335 | INFO | app.core.state.soft_state_machine | 🔍 JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,335 | ERROR | app.core.state.soft_state_machine | ❌ Errore parsing JSON: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,336 | ERROR | app.core.state.soft_state_machine | ❌ JSON pulito: Ciao! Sono Sofia, l'assistente virtuale dello Studio Immigrato di Milano. Posso aiutarti con pratiche di immigrazione, consulenze legali e appuntamenti. Come posso esserti utile oggi?
2025-07-26 22:52:55,336 | ERROR | app.core.state.soft_state_machine | ❌ Errore dettagliato: Expecting value: line 1 column 1 (char 0)
2025-07-26 22:52:55,336 | INFO | app.core.state.soft_state_machine | 🔄 Applico fallback intelligente migliorato
2025-07-26 22:52:55,336 | INFO | app.core.state.soft_state_machine | 🔄 Fallback intelligente - Turno: 0, Messaggio: Hello, I need help with my res...
2025-07-26 22:52:55,336 | INFO | app.core.state.soft_state_machine | 🔄 Fallback: GREETING (primo turno)
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔍 Stato classificato: GREETING (confidence: 0.8)
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔍 Manager decide strategia...
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🎯 MANAGER DECIDE - Confidence: 0.8, State: GREETING
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | ✅ Confidence buona (0.8), reset clarification count
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🎯 Strategia scelta: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🎯 Manager decide: {'action': 'present_sofia', 'instruction': 'Presentati come Sofia e chiedi come puoi aiutare'}
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔍 Worker genera risposta...
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 WORKER INIZIATO - Action: present_sofia
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 Action: present_sofia, Instruction: Presentati come Sofia e chiedi come puoi aiutare
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 Parahelp template caricato
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 Prompt generato, lunghezza: 6410 caratteri
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 Chiamata LLM in corso...
2025-07-26 22:52:55,336 | WARNING | app.gateways.llm | ⚠️ Client OpenAI non disponibile, uso fallback
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 LLM response ricevuta: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 Response pulita: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazion...
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔧 Worker reply: Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🔍 Aggiornamento memoria...
2025-07-26 22:52:55,336 | WARNING | app.gateways.memory | ⚠️ Firestore non disponibile, simulo salvataggio
2025-07-26 22:52:55,336 | INFO | app.core.planner.manager_worker_planner | 🎯 Plan result: {'reply': 'Ciao! Sono Sofia dello Studio Immigrato. Come posso aiutarti oggi con le tue pratiche di immigrazione?', 'state': 'GREETING', 'confidence': 0.8, 'next_action': None}
2025-07-26 22:52:55,336 | INFO | __main__ | ✅ Test inglese OK: Ciao! Sono Sofia dello Studio Immigrato. Come poss...
2025-07-26 22:52:55,336 | INFO | __main__ | ✅ TUTTI I TEST CASI LIMITE SUPERATI!
2025-07-26 22:52:55,336 | INFO | __main__ | 📊 RISULTATI FINALI:
2025-07-26 22:52:55,336 | INFO | __main__ |    Conversazione Completa: ✅ OK
2025-07-26 22:52:55,336 | INFO | __main__ |    Persistenza Memoria: ✅ OK
2025-07-26 22:52:55,336 | INFO | __main__ |    Casi Limite: ✅ OK
2025-07-26 22:52:55,336 | INFO | __main__ | 🎉 TUTTI I TEST FINALI SUPERATI!
2025-07-26 22:52:55,336 | INFO | __main__ | 🎯 SOFIA AI RAG/MEMORY SYSTEM: PERFETTO!
